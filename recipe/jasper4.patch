diff -ruN -x __pycache__ -x obj -x '*~' -x tags -x TAGS -x autom4te.cache grib2.orig/wgrib2/enc_jpeg2000_clone.c grib2/wgrib2/enc_jpeg2000_clone.c
--- grib2.orig/wgrib2/enc_jpeg2000_clone.c	2023-05-25 14:42:47.730186711 +0200
+++ grib2/wgrib2/enc_jpeg2000_clone.c	2023-05-25 14:47:04.150500344 +0200
@@ -67,7 +67,7 @@
 *
 *$$$*/
 {
-    int ier,rwcnt;
+    int ier,rwcnt,fmt;
     jas_image_t image;
     jas_stream_t *jpcstream,*istream;
     jas_image_cmpt_t cmpt,*pcmpt;
@@ -171,7 +171,8 @@
 //
 //     Encode image.
 //
-    ier=jpc_encode(&image,jpcstream,opts);
+    fmt=jas_image_strtofmt("jpc");
+    ier=jas_image_encode(&image,jpcstream,fmt,opts);
     if ( ier != 0 ) {
        printf(" jpc_encode return = %d \n",ier);
        return -3;
